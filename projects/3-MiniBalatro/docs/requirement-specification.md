## 1. **Introduction**

The objective of this project is to develop a **web card game inspired by Balatro** that combines poker mechanics with roguelike elements. The player must overcome progressive scoring levels by playing strategic poker hands with a French deck of 52 cards, enhanced by special cards: **planets** (permanent upgrades), **tarot** (tactical effects), and **jokers** (persistent bonuses).

The system includes **level progression with three difficulty types** (Small/Big/Boss Blind), **shop purchase economy** between levels, and **boss encounters** every third level that modify game rules. The experience is optimized to be understandable, controlled, and efficiently generated by AI.

---

## 2. **Scope**

The application will allow:

- Playing poker hands with standard 52-card French deck.
- Managing three types of hands simultaneously: main hand (8 cards), jokers (5 maximum), and consumables (2 maximum).
- Calculating scores based on chips and multipliers system with strict activation order.
- Progressing through levels with increasing scoring goals (Small Blind, Big Blind, Boss Blind).
- Discarding cards up to 3 times per level to optimize strategies.
- Purchasing special cards (planets, tarot, jokers) in shop between levels.
- Facing 5 different types of Boss Blinds with unique restrictions every third level.
- Managing economy with initial money, level rewards, and shop costs.
- Saving and continuing games through data persistence.
- Clearly visualizing game state, scores, active effects, and goals.

Does not include:

- Spectral cards or spectral effects.
- Purchase vouchers or discounts.
- Card packs (booster packs).
- Multiplayer mode or online connection.
- More than 5 types of Boss Blinds.
- Complex effects beyond the 20 jokers, 10 planets, and 10 tarot specified.

---

## 3. **Definitions and Abbreviations**

- **Blind:** Level or round of the game (Small, Big, or Boss).
- **Chips:** Base scoring component that is added.
- **Mult (Multiplier):** Multiplicative scoring component.
- **Joker:** Special card that provides persistent bonuses throughout the entire game.
- **Planet Card:** Card that permanently improves a specific type of poker hand.
- **Tarot Card:** Single-use consumable card that modifies deck cards or provides tactical benefits.
- **Boss Blind:** Special level every three levels with unique restrictions.
- **Discard:** Action of replacing cards from the main hand with new ones from the deck.
- **Synergy:** Simultaneous activation of multiple joker effects by the same played card.
- **Reroll:** Regenerate available cards in the shop by paying a cost.
- **French Deck:** Standard 52-card deck (13 values × 4 suits).

---

## 4. **Functional Requirements (FR)**

| Code | Requirement | Acceptance Criteria |
| --- | --- | --- |
| FR1 | Deal initial hand of 8 cards at the start of each level. | At the start of each level, 8 random cards from the 52-card deck are dealt to the player. |
| FR2 | Selection of up to 5 cards to play a poker hand. | The player can select between 1 and 5 cards from their main hand, with visual limit preventing selection of more than 5. |
| FR3 | Automatic recognition of poker hand type. | When playing selected cards, the system automatically identifies the hand type (High Card, Pair, Three of a Kind, Straight, Flush, etc.) and applies corresponding base values. |
| FR4 | Discard cards up to 3 times per level. | The player can discard selected cards up to 3 times. Each discard consumes a visible counter that resets each level. |
| FR5 | Automatic replacement of discarded cards. | Discarded cards are removed from hand and immediately replaced with new cards from the deck. |
| FR6 | Limit of 3 playable hands per level. | The player can play a maximum of 3 hands per level. Each hand played consumes a visible counter. |
| FR7 | Score calculation according to formula: chips × mult. | The final score of each hand is calculated by multiplying accumulated total chips by total multiplier. |
| FR8 | Strict scoring calculation order. | The system applies: (1) hand base values, (2) individual values of played cards + synergies, (3) joker effects in priority order (chips → mult → mult multipliers). |
| FR9 | Level progression with increasing goals. | Each level has a specific point goal that increases progressively. Small Blind (1×), Big Blind (1.5×), and Boss Blind (2× with exceptions) alternate. |
| FR10 | Victory upon reaching level point goal. | If the sum of points from all played hands equals or exceeds the goal, the level is passed and money reward is granted. |
| FR11 | Defeat upon exhausting 3 hands without reaching goal. | If 3 available hands are played without reaching the point goal, the level is lost and the game ends. |
| FR12 | Management of three simultaneous hand types. | The system maintains separately: main hand (8 renewable cards), joker hand (5 maximum, persistent), consumable hand (2 maximum, tarot). |
| FR13 | Application of planet card effects. | When buying a planet card, chips and base mult of the corresponding hand type are permanently increased for the entire game. |
| FR14 | Application of tarot card effects. | When using a tarot card from the consumables inventory, its specific effect is applied (double money, improve card, change suit, etc.). |
| FR15 | Application of joker effects. | Active jokers in the joker hand apply their bonuses during calculation of each played hand according to their order and conditions. |
| FR16 | Detection and application of synergies. | When a card meets requirements of multiple jokers (e.g., K of Spades with Triboulet + Wrathful Joker), all effects are applied in correct order. |
| FR17 | Economy system with initial money of $5. | The player starts each game with $5 and can accumulate more by passing levels or through special effects. |
| FR18 | Rewards for passing levels. | When passing Small Blind +$2 is granted, Big Blind +$5, and Boss Blind +$10. |
| FR19 | Shop between levels with 4 random cards. | After passing a level, a shop automatically appears showing 4 random cards (planets, tarot, or jokers) available for purchase. |
| FR20 | Card purchase in shop. | The player can buy cards if they have sufficient money: jokers ($5), planets ($3), tarot ($3). The purchased card is added to corresponding inventory. |
| FR21 | Shop reroll. | The shop includes a reroll button that regenerates the 4 available cards by paying a configurable cost. |
| FR22 | Boss Blinds every third level. | Every third level is a Boss Blind randomly selected from 5 types and applies special restrictions during that level. |
| FR23 | The Wall effects. | Boss that increases scoring goal to 4× the round base. |
| FR24 | The Water effects. | Boss that starts the level with 0 available discards. |
| FR25 | The Mouth effects. | Boss that restricts play to one specific type of poker hand during the level. |
| FR26 | The Needle effects. | Boss that allows playing only 1 hand (reduces goal to 1× base). |
| FR27 | The Flint effects. | Boss that halves the base chips and mult of all played hands. |
| FR28 | Game persistence. | The system automatically saves game state (deck, jokers, money, current level) in localStorage or JSON to continue later. |
| FR29 | Continuation of saved games. | The player can load a saved game from the main menu and continue from the exact state it was saved. |
| FR30 | Score preview. | While the player has cards selected, a preview of the chips and mult that would be obtained by playing that hand is displayed. |

---

## 5. **Non-Functional Requirements (NFR)**

| Code | Requirement | Acceptance Criteria |
| --- | --- | --- |
| NFR1 | Compatible with modern browsers. | The application functions correctly in Chrome, Firefox, and Edge (versions from the last 2 years). |
| NFR2 | Clear interface with differentiated zones. | The UI has visually separated areas for: main hand, jokers, consumables, level information, shop, and controls. |
| NFR3 | Immediate response to user actions. | Actions (selecting cards, playing hand, buying in shop) respond in less than 1 second. |
| NFR4 | Modular and organized code. | Code is divided into separate modules: deck, game logic, UI, economy, shop, bosses, with clear responsibilities. |
| NFR5 | Code documentation. | Critical functions and modules include explanatory comments about their purpose and functionality. |
| NFR6 | Unit tests for critical functions. | Tests are implemented for: poker hand calculation, joker activation, boss effects, and total score calculation. |
| NFR7 | Simple animations or 2D pixel art style. | Animations are subtle and do not interfere with game flow. Visual style prioritizes readability over graphic complexity. |
| NFR8 | Clear visual feedback. | Each card effect or bonus displays visual indicators (floating numbers, highlights, counter animations). |
| NFR9 | Configurable values for balancing. | All chip, mult, cost, and scoring goal values are in separate configuration files to facilitate adjustments. |
| NFR10 | Persistence through localStorage or JSON. | Game state is automatically saved using browser localStorage or external JSON files. |
| NFR11 | Strict effect activation order. | The system respects documented order: base values → individual cards → chip jokers → mult jokers → multiplier jokers. |
| NFR12 | Basic responsive design. | The interface adapts to different screen sizes maintaining complete functionality (minimum 1024px width recommended). |

---

## 6. **Optional Considerations**

- **Achievement system:** Unlock achievements for meeting specific objectives (e.g., win with only 1 joker, pass 10 boss blinds).
- **High score table:** Record best games with total score, levels passed, and time.
- **Adjustable difficulty mode:** Variants with higher scoring goals or fewer available hands.
- **Sounds and music:** Audio effects for actions (play hand, buy card, victory/defeat) and thematic background music.
- **Advanced animations:** Elaborate visual effects for special hands (Straight Flush, Four of a Kind) or activation of multiple synergies.
- **Interactive tutorial:** Guided sequence explaining basic mechanics in first levels.
- **More types of jokers and cards:** Expansion of special effects and synergies catalog.
- **Seed system:** Deterministic deck generation for reproducible games or specific challenges.
- **Game statistics:** Detailed summary at end showing hands played, jokers used, money spent, etc.

---

## 7. **Actor Summary**

- **Player:** Interacts with the system by selecting cards, playing hands, discarding, buying in shop, using tarot, and managing strategies to pass progressive levels.
- **System:** Manages game logic (card dealing, poker hand recognition, score calculation with strict effect order), controls level progression, generates random shops, applies boss effects, maintains economy, saves game state, and determines victory or defeat conditions.

---

## 8. **Detailed Game Mechanics**

### 8.1 Poker Hands System

**Recognized hand types and base values:**

| Poker Hand | Base Chips | Base Mult |
| --- | --- | --- |
| High Card | 5 | 1 |
| Pair | 10 | 2 |
| Two Pair | 20 | 2 |
| Three of a Kind | 30 | 3 |
| Straight | 30 | 4 |
| Flush | 35 | 4 |
| Full House | 40 | 4 |
| Four of a Kind | 60 | 7 |
| Straight Flush | 100 | 8 |

**Recognition hierarchy:** The system detects the best possible hand with selected cards, prioritizing from highest to lowest: Straight Flush > Four of a Kind > Full House > Flush > Straight > Three of a Kind > Two Pair > Pair > High Card.

### 8.2 Individual Card Values

Each card in the French deck has a base chip value when played:

- **A (Ace):** 11 chips
- **K (King):** 10 chips
- **Q (Queen):** 10 chips
- **J (Jack):** 10 chips
- **10 to 2:** corresponding numerical value in chips

These values are added to the hand’s base chips before applying jokers.

### 8.3 Score Calculation Order (Detailed)

**Step 1: Poker hand base values**
- Base chips and mult are identified according to the played hand type

**Step 2: Individual card evaluation**
- For each played card (left to right):
- Individual card chips are added
- Jokers acting “per played card” are evaluated (e.g., Greedy Joker +3 mult if Diamond)
- Tarot improvement effects on the card are applied (e.g., The Empress +4 mult)

**Step 3: Persistent joker effects**
- **Priority 1:** Jokers that increase total chips (e.g., Blue Joker, Odd Todd)
- **Priority 2:** Jokers that increase total mult (e.g., Joker, Half Joker, Mystic Summit)
- **Priority 3:** Jokers that multiply total mult (e.g., Triboulet, Joker Stencil)
- **Priority 4:** Other special effects

**Step 4: Final calculation**
- Score = Total Chips × Total Mult

### 8.4 Planet Cards and Permanent Upgrades

| Planet Card | Improved Hand Type | Additional Chips | Additional Mult |
| --- | --- | --- | --- |
| Pluto | High Card | +10 | +1 |
| Mercury | Pair | +15 | +1 |
| Uranus | Two Pair | +20 | +1 |
| Venus | Three of a Kind | +20 | +2 |
| Saturn | Straight | +30 | +3 |
| Jupiter | Flush | +15 | +2 |
| Earth | Full House | +25 | +2 |
| Mars | Four of a Kind | +30 | +3 |
| Neptune | Straight Flush | +40 | +4 |

**Operation:** When buying a planet card in the shop, the increment to that hand type’s base values is immediately and permanently applied for the rest of the game.

### 8.5 Tarot Cards and Tactical Effects

| Tarot Card | Effect |
| --- | --- |
| The Hermit | Doubles player’s current money |
| The Empress | Choose a card to grant +4 mult when played (permanent) |
| The Emperor | Choose a card to grant +20 chips when played (permanent) |
| Strength | Choose a card to increment its value in sequence (A→2, 2→3, …, K→A) |
| The Hanged Man | Choose a card from the deck to destroy permanently |
| Death | Choose a card to add a duplicate copy to the deck |
| The Star | Choose a card to change its suit to Diamonds |
| The Moon | Choose a card to change its suit to Clubs |
| The Sun | Choose a card to change its suit to Hearts |
| The World | Choose a card to change its suit to Spades |

**Usage:** Tarot cards are stored in the consumables inventory (maximum 2) and used during the level via specific button. Effects are permanent except The Hermit (instant).

### 8.6 Complete Joker Catalog

| Joker | Effect | Type |
| --- | --- | --- |
| Joker | +4 mult | Fixed mult |
| Greedy Joker | +3 mult per Diamond card played | Conditional mult |
| Lusty Joker | +3 mult per Heart card played | Conditional mult |
| Wrathful Joker | +3 mult per Spade card played | Conditional mult |
| Gluttonous Joker | +3 mult per Club card played | Conditional mult |
| Half Joker | +20 mult if hand contains 3 cards or less | Conditional mult |
| Joker Stencil | ×1 mult per empty slot in joker hand | Multiplier |
| Mystic Summit | +15 mult if no discards available | Conditional mult |
| Fibonacci | +8 mult per A, 2, 3, 5, or 8 played | Mult per card |
| Even Steven | +4 mult per even value card (2,4,6,8,10) played | Mult per card |
| Odd Todd | +31 chips per odd value card (A,3,5,7,9) played | Chips per card |
| Blue Joker | +2 chips per remaining card in deck (max +104) | Conditional chips |
| Hiker | Each played card permanently gains +5 chips (cumulative) | Permanent upgrade |
| Golden Joker | +$2 at the end of each passed level | Economic |
| Triboulet | Each K or Q played multiplies total mult by ×2 | Multiplier |

### 8.7 Boss Blinds and Restrictions

| Boss | Effect During Level |
| --- | --- |
| The Wall | Scoring goal increases to 4× round base |
| The Water | Level starts with 0 available discards |
| The Mouth | Only one specific type of poker hand is allowed |
| The Needle | Only 1 hand can be played (goal reduced to 1× base) |
| The Flint | Base chips and mult of all hands are halved |

**Selection:** Upon reaching a Boss Blind (every third level), one of these 5 bosses is randomly selected and its effects are applied only during that level.

---

## 9. **Detailed Economy System**

### 9.1 Initial Money and Income Sources

- **Initial money:** $5 when starting a new game
- **Level rewards:**
    - Small Blind passed: +$2
    - Big Blind passed: +$5
    - Boss Blind passed: +$10
- **Special effects:**
    - Golden Joker active: +$2 additional per passed level
    - The Hermit (tarot): doubles current money instantly

### 9.2 Shop Costs

| Item | Cost |
| --- | --- |
| Joker Card | $5 |
| Planet Card | $3 |
| Tarot Card | $3 |
| Shop Reroll | Variable (suggested: $2-5) |

### 9.3 Inventory Management

- **Jokers:** Maximum 5 simultaneous. If buying a sixth, must replace an existing one.
- **Consumables (Tarot):** Maximum 2 simultaneous. If buying a third, must replace an existing one.
- **Planets:** Applied immediately without occupying inventory space.

---

## 10. **Detailed User Interface**

### 10.1 Main Game Area

**Visual elements:**
- **Current hand:** 8 cards arranged horizontally, selectable by click
- **Selection indicator:** Highlighted border or vertical displacement of selected cards
- **Visual limit:** “5/5” indicator when maximum selectable cards is reached
- **Action buttons:**
- “Play Hand” (enabled only with selected cards)
- “Discard” (enabled only with selected cards and available discards)
- **Top counters:**
- “Hands: X/3” with hand icon
- “Discards: X/3” with discard icon
- **Level information:**
- Current blind type (Small/Big/Boss + name if boss)
- Accumulated points / Point goal
- Visual progress bar
- **Preview:** Panel showing “Chips: X | Mult: Y | Total: Z” when cards are selected

### 10.2 Active Jokers Area

**Elements:**
- 5 horizontal spaces for jokers
- Visible joker cards with names and effects
- Activation order indicator (numbers or left→right arrow)
- Empty spaces clearly differentiated from occupied ones

### 10.3 Consumables Area

**Elements:**
- 2 spaces for tarot cards
- Visible cards with names
- “Use” button below each tarot card
- Empty spaces when no tarot available

### 10.4 Shop Between Levels

**Layout:**

```
┌─────────────────────────────────────┐
│         SHOP - Money: $XX           │
├─────────────────────────────────────┤
│  [Card 1]  [Card 2]  [Card 3]       │
│   $5         $3         $3          │
│  [Card 4]                           │
│   $3                                │
├─────────────────────────────────────┤
│  [Reroll - $2]         [Continue]   │
└─────────────────────────────────────┘
```

**Elements:**
- Current balance highlighted at top
- 4 available cards with type, name, and visible price
- Purchase button below each card (disabled if insufficient money)
- Reroll button with visible cost
- “Continue” button to exit shop and advance to next level

### 10.5 Additional Screens

**Main menu:**
- New Game
- Continue (disabled if no saved game)
- Help / Tutorial
- Exit

**Victory screen:**
- “Victory!” message
- Summary: Levels passed, total score, remaining money
- Buttons: “New Game” / “Main Menu”

**Defeat screen:**
- “Game Over” message
- Information: “You didn’t reach X points in Y level”
- Buttons: “Retry” / “Main Menu”

**Help panel:**
- Explanation of poker hands with visual examples
- List of all jokers with effects
- List of planet and tarot cards
- Description of boss blinds
- Explanation of scoring system

---

## 11. **Complete Game Flow**

### 11.1 Game Start

1. User selects “New Game” from main menu
2. System initializes:
    - Money = $5
    - Deck = 52 standard shuffled cards
    - Jokers = empty
    - Consumables = empty
    - Level = Small Blind #1
    - Goal = round 1 base score
3. Initial 8-card hand is dealt
4. Complete game interface is displayed

### 11.2 Level Development

1. **Player turn:**
    - Selects up to 5 cards from main hand
    - Chooses an action:
        - **Play Hand:** System calculates complete score, updates counters, shows result
        - **Discard:** Replaces selected cards, consumes discard
2. **Goal verification:**
    - If accumulated points ≥ goal: Level passed → Go to step 3
    - If remaining hands = 0 and points < goal: Defeat → Game end
    - If remaining hands > 0: Repeat from step 1
3. **Successful level end:**
    - Grant money reward according to blind type
    - Activate post-level effects (e.g., Golden Joker +$2)
    - Open shop with 4 random cards
    - Player can buy, reroll, or exit
    - Upon exit: advance to next level

### 11.3 Boss Blind (Every Third Level)

1. System randomly selects 1 of 5 bosses
2. Introduction screen shown with boss name and effect
3. Boss modifications applied:
    - **The Wall:** Goal × 4
    - **The Water:** Discards = 0
    - **The Mouth:** Randomly selects allowed hand type
    - **The Needle:** Hands = 1, Goal × 0.5
    - **The Flint:** Divides base chips and mult of all hands by 2
4. Level develops with modified rules
5. Upon passing: +$10 reward and shop

### 11.4 Completion Conditions

**Victory:**
- Upon passing a determined number of complete rounds (e.g., 8 rounds = 24 levels)
- Shows victory screen with statistics
- Options: New Game or Main Menu

**Defeat:**
- Upon not reaching goal with available hands at any level
- Shows defeat screen with information about failed level
- Options: Retry (new game) or Main Menu

---

## 12. **Synergy Examples**

### 12.1 Example 1: K of Spades with Triboulet + Wrathful Joker

**Played cards:** K of Spades (in a Pair hand)

**Calculation:**
1. **Base:** Pair = 10 chips × 2 mult
2. **Individual card:** K of Spades = +10 chips
3. **Wrathful Joker synergy:** K is Spades → +3 mult
4. **Triboulet:** K played → total mult ×2
5. **Result:** (10 + 10) chips × (2 + 3) mult = 20 × 5 = 100 points
6. **Apply Triboulet:** 100 × 2 = **200 final points**

### 12.2 Example 2: Hand of 5 with Fibonacci + Even Steven + Odd Todd

**Played cards:** A♠, 2♥, 3♦, 5♣, 8♠ (High Card)

**Calculation:**
1. **Base:** High Card = 5 chips × 1 mult
2. **Individual cards:**
- A♠ = +11 chips
- 2♥ = +2 chips
- 3♦ = +3 chips
- 5♣ = +5 chips
- 8♠ = +8 chips
- **Individual chips subtotal:** 11+2+3+5+8 = 29 chips
3. **Fibonacci:** A, 2, 3, 5, 8 are Fibonacci values → +8 mult × 5 cards = +40 mult
4. **Even Steven:** 2♥ and 8♠ are even → +4 mult × 2 = +8 mult
5. **Odd Todd:** A♠, 3♦, 5♣ are odd → +31 chips × 3 = +93 chips
6. **Result:** (5 + 29 + 93) chips × (1 + 40 + 8) mult = **127 × 49 = 6,223 points**

### 12.3 Example 3: Flush with Greedy Joker + Joker + Blue Joker

**Played cards:** 4♦, 7♦, 9♦, J♦, K♦ (Diamond Flush)
**Context:** 40 cards remaining in deck

**Calculation:**
1. **Base:** Flush = 35 chips × 4 mult
2. **Individual cards:**
- 4♦ = +4 chips
- 7♦ = +7 chips
- 9♦ = +9 chips
- J♦ = +10 chips
- K♦ = +10 chips
- **Subtotal:** 40 chips
3. **Greedy Joker:** 5 Diamond cards → +3 mult × 5 = +15 mult
4. **Joker:** +4 mult (fixed)
5. **Blue Joker:** 40 cards in deck → +2 chips × 40 = +80 chips
6. **Result:** (35 + 40 + 80) chips × (4 + 15 + 4) mult = **155 × 23 = 3,565 points**

---

## 13. **Testing Specifications**

### 13.1 Required Unit Tests

**test_poker_hands.js:**
- Correct recognition of High Card with 5 different cards
- Correct recognition of Pair, Two Pair, Three of a Kind
- Correct recognition of Straight (consecutive values)
- Correct recognition of Flush (same suit)
- Correct recognition of Full House (Three of a Kind + Pair)
- Correct recognition of Four of a Kind (4 equal cards)
- Correct recognition of Straight Flush
- Correct prioritization when multiple hands are possible

**test_scoring.js:**
- Correct base score calculation without jokers
- Correct sum of individual card values
- Correct application of effect order (chips → mult → multipliers)
- Correct calculation with multiple active jokers
- Correct application of simultaneous synergies
- Tarot improvement effects on specific cards

**test_jokers.js:**
- Correct activation of each of the 15 jokers
- Verification of conditions (e.g., Half Joker only with ≤3 cards)
- Correct application of multiplier jokers (Triboulet, Joker Stencil)
- Correct activation order with multiple jokers present
- Cumulative effects (e.g., Hiker increasing chips permanently)

**test_planets.js:**
- Correct application of permanent upgrade to each hand type
- Persistence of upgrades between levels
- Correct accumulation of multiple planets of same type

**test_tarot.js:**
- The Hermit doubles money correctly
- The Empress/Emperor add permanent bonuses to cards
- Strength increments card value in sequence (including K→A)
- The Hanged Man removes card from deck permanently
- Death duplicates card in deck
- Suit change cards (Star, Moon, Sun, World) function correctly

**test_bosses.js:**
- The Wall increases goal to 4× correctly
- The Water starts with 0 discards
- The Mouth restricts to single hand type
- The Needle limits to 1 hand and reduces goal
- The Flint divides base chips and mult by 2
- Boss effects apply only during their level

**test_economy.js:**
- Initial money of $5 when starting game
- Correct rewards by blind type ($2, $5, $10)
- Golden Joker adds $2 when passing levels
- Shop purchases subtract correct money
- Does not allow buying without sufficient money

**test_persistence.js:**
- Correct saving of complete game state
- Correct loading of saved game with all data
- Persistence of planet upgrades between sessions
- Persistence of jokers and tarot in inventory

### 13.2 Minimum Coverage

- **Line coverage:** ≥75%
- **Critical function coverage:** 100% for:
    - Poker hand recognition
    - Score calculation with effect order
    - Joker activation
    - Boss effect application
    - Economy system (purchases and rewards)
- **Edge case coverage:**
    - Empty hand (0 selected cards)
    - Maximum hand (5 cards)
    - No money in shop
    - Full joker/tarot inventory
    - Last level (victory)

---

## 14. **Suggested File Structure**

```
src/
├── core/
│   ├── Deck.ts              # 52-card deck class
│   ├── Card.ts              # Individual card class
│   ├── HandEvaluator.ts     # Poker hand recognition
│   ├── ScoreCalculator.ts   # Score calculation with order
│   └── GameState.ts         # Global game state
├── cards/
│   ├── Joker.ts             # Base class and joker types
│   ├── Planet.ts            # Planet cards
│   └── Tarot.ts             # Tarot cards
├── blinds/
│   ├── Blind.ts             # Base blind class
│   ├── SmallBlind.ts
│   ├── BigBlind.ts
│   └── BossBlind.ts         # 5 boss types
├── systems/
│   ├── Economy.ts           # Money and rewards system
│   ├── Shop.ts              # Shop logic
│   └── Persistence.ts       # Save and load
├── ui/
│   ├── GameBoard.tsx        # Main game area
│   ├── HandDisplay.tsx      # Hand visualization
│   ├── JokerDisplay.tsx     # Joker area
│   ├── ConsumableDisplay.tsx # Consumables area
│   ├── ShopUI.tsx           # Shop interface
│   ├── ScoreDisplay.tsx     # Score information
│   └── Menu.tsx             # Main menus
├── config/
│   ├── cardValues.json      # Base card values
│   ├── handValues.json      # Hand chips and mult
│   ├── jokerEffects.json    # Joker effects
│   ├── planetEffects.json   # Planet upgrades
│   ├── tarotEffects.json    # Tarot effects
│   └── blindTargets.json    # Scoring goals per level
├── utils/
│   ├── cardHelpers.ts       # Card utilities
│   ├── mathHelpers.ts       # Auxiliary calculations
│   └── animations.ts        # Animation functions
├── tests/
│   ├── poker_hands.test.ts
│   ├── scoring.test.ts
│   ├── jokers.test.ts
│   ├── planets.test.ts
│   ├── tarot.test.ts
│   ├── bosses.test.ts
│   ├── economy.test.ts
│   └── persistence.test.ts
├── assets/
│   ├── cards/               # Card images
│   ├── jokers/              # Joker images
│   ├── planets/             # Planet images
│   ├── tarot/               # Tarot images
│   └── ui/                  # Interface elements
├── App.tsx
└── main.tsx
```

---

## 15. **Value Configuration (JSON)**

### 15.1 handValues.json

```json
{
	"highCard": { "chips": 5, "mult": 1 },
	"pair": { "chips": 10, "mult": 2 },
	"twoPair": { "chips": 20, "mult": 2 },
	"threeOfAKind": { "chips": 30, "mult": 3 },
	"straight": { "chips": 30, "mult": 4 },
	"flush": { "chips": 35, "mult": 4 },
	"fullHouse": { "chips": 40, "mult": 4 },
	"fourOfAKind": { "chips": 60, "mult": 7 },
	"straightFlush": { "chips": 100, "mult": 8 }
}
```

### 15.2 cardValues.json

```json
{
  "A": 11,
  "K": 10,
  "Q": 10,
  "J": 10,
  "10": 10,
  "9": 9,
  "8": 8,
  "7": 7,
  "6": 6,
  "5": 5,
  "4": 4,
  "3": 3,
  "2": 2
}
```

### 15.3 jokerEffects.json

```json
{
  "joker": {
    "name": "Joker",
    "effect": "mult",
    "value": 4,
    "condition": "always"
  },
  "greedyJoker": {
    "name": "Greedy Joker",
    "effect": "mult",
    "value": 3,
    "condition": "perDiamond"
  },
  "triboulet": {
    "name": "Triboulet",
    "effect": "multMultiplier",
    "value": 2,
    "condition": "perKingOrQueen"
  }
  // ... rest of jokers
}
```

### 15.4 blindTargets.json

```json
{
  "round1": {
    "small": 300,
    "big": 450,
    "boss": 600
  },
  "round2": {
    "small": 450,
    "big": 675,
    "boss": 900
  }
  // ... more rounds with progression
}
```

---

## 16. **Score Calculation Algorithm (Pseudocode)**

```
FUNCTION calculateScore(playedCards, jokers, handType):
    // Step 1: Initialize with base values
    chips = handType.baseChips
    mult = handType.baseMult

    // Step 2: Evaluate individual cards
    FOR EACH card IN playedCards:
        chips += card.baseValue

        // Apply tarot improvements on card
        IF card.hasEmpress:
            mult += 4
        IF card.hasEmperor:
            chips += 20

        // Apply "per card" jokers
        FOR EACH joker IN jokers:
            IF joker.triggerCondition(card):
                IF joker.effectType == "mult":
                    mult += joker.value
                ELSE IF joker.effectType == "chips":
                    chips += joker.value

    // Step 3: Apply persistent jokers
    // Priority 1: Jokers that add chips
    FOR EACH joker IN jokers WHERE joker.priority == "chips":
        IF joker.globalCondition():
            chips += joker.calculateChips()

    // Priority 2: Jokers that add mult
    FOR EACH joker IN jokers WHERE joker.priority == "mult":
        IF joker.globalCondition():
            mult += joker.calculateMult()

    // Priority 3: Multiplier jokers
    FOR EACH joker IN jokers WHERE joker.priority == "multiplier":
        IF joker.globalCondition():
            mult *= joker.multiplier

    // Step 4: Final calculation
    finalScore = chips × mult

    RETURN finalScore
```

---

## 17. **Difficulty Progression**

### 17.1 Goals Formula per Round

**Round N base:**

```
baseScore = 300 × (1.5)^(N-1)
```

**Goals by blind type:**
- Small Blind: baseScore × 1
- Big Blind: baseScore × 1.5
- Boss Blind: baseScore × 2 (except boss modifiers)

### 17.2 Progression Example

| Round | Small Blind | Big Blind | Boss Blind |
| --- | --- | --- | --- |
| 1 | 300 | 450 | 600 |
| 2 | 450 | 675 | 900 |
| 3 | 675 | 1,013 | 1,350 |
| 4 | 1,013 | 1,519 | 2,025 |
| 5 | 1,519 | 2,279 | 3,038 |
| 6 | 2,279 | 3,418 | 4,556 |
| 7 | 3,418 | 5,127 | 6,835 |
| 8 | 5,127 | 7,691 | 10,253 |

**Note:** These values are suggested and configurable for balancing.

---

## 18. **Suggested Visual Design**

### 18.1 Color Palette

**General theme:**
- **Background:** `#1a1a2e` (deep dark blue)
- **Panels:** `#16213e` (navy blue)
- **Borders:** `#0f3460` (medium blue)
- **Accents:** `#e94560` (bright red)
- **Primary text:** `#f1f1f1` (soft white)
- **Secondary text:** `#a8a8a8` (light gray)

**Suit colors:**
- **Diamonds:** `#ff6b6b` (red)
- **Hearts:** `#ee5a6f` (pink-red)
- **Spades:** `#4ecdc4` (turquoise)
- **Clubs:** `#95e1d3` (aqua green)

**Indicators:**
- **Chips:** `#f9ca24` (golden yellow)
- **Mult:** `#6c5ce7` (purple)
- **Money:** `#00d2d3` (cyan)

### 18.2 Full Screen Layout

```
┌────────────────────────────────────────────────────────┐
│  Level: Big Blind #2    Money: $12    Round: 1        │
├────────────────────────────────────────────────────────┤
│                                                        │
│  Jokers:  [Joker] [Greedy J] [___] [___] [___]       │
│  Consumables: [The Hermit] [___]                      │
│                                                        │
├────────────────────────────────────────────────────────┤
│                                                        │
│  Goal: 450 pts                                         │
│  Accumulated: 285 pts  ▓▓▓▓▓▓▓▓░░░░░░░░ (63%)         │
│                                                        │
│  Current hand (5 selected):                            │
│  [A♠] [A♥] [K♦] [Q♣] [J♠] [10♦] [9♥] [2♣]          │
│   ▲    ▲    ▲    ▲    ▲                              │
│                                                        │
│  Preview: 65 chips × 10 mult = 650 pts                │
│                                                        │
│  [Play Hand]  [Discard]                               │
│  Hands: 2/3    Discards: 1/3                          │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### 18.3 Card Design

**Suggested dimensions:** 100px × 140px

**Card elements:**
- Value and suit in top left corner
- Suit symbol centered (large)
- Value and suit in bottom right corner (inverted)
- 8px rounded border
- Subtle shadow for depth

**Special cards:**
- **Jokers:** Purple-gold gradient background
- **Planets:** Dark blue background with stars
- **Tarot:** Mystical background with decorative borders

---

## 19. **Recommended Animations**

### 19.1 Gameplay Animations

- **Card selection:** 20px vertical displacement + bright border
- **Play hand:** Cards move to center, calculate score with floating numbers, return
- **Discard:** Selected cards fade out, new cards appear with shuffle effect
- **Joker activation:** Glow or light pulse around active joker
- **Score increment:** Numbers that increase progressively with counter effect
- **Reach goal:** Confetti explosion + victory animation

### 19.2 Shop Animations

- **Shop opening:** Slide transition from top
- **Card purchase:** Card flies to corresponding inventory
- **Reroll:** Cards rotate and replace with shuffle effect
- **Insufficient money:** Subtle vibration in card price

### 19.3 Level Transitions

- **Level passed:** Fade out → Reward screen → Fade in to shop
- **Boss Blind:** Dramatic introduction screen with boss name and effect
- **Defeat:** Slow motion on last hand → Fade to black → Game Over screen

---

## 20. **Accessibility and UX**

### 20.1 Accessibility Considerations

- **Color contrast:** Minimum 4.5:1 ratio for all text
- **Font size:** Minimum 14px for descriptive text, 16px for critical information
- **Visual indicators:** Do not rely solely on color (use icons + text)
- **Keyboard navigation:** Support for Tab, Enter, Space, arrows
- **Informative tooltips:** Hover over special cards shows detailed explanation
- **High contrast mode:** Option to increase UI contrast

### 20.2 User Experience Improvements

- **Interactive tutorial:** First game guides player through basic mechanics
- **Effect summary:** Panel showing all active jokers and their current effects
- **Action confirmation:** Confirmation dialog before exiting game in progress
- **Hand history:** Visible log of last 3 played hands with their scores
- **Score calculator:** Optional tool showing complete calculation breakdown
- **Keyboard shortcuts:** Space for Play Hand, D for Discard, numbers 1-8 to select cards

---

## 21. **Deliverables**

1. **Complete source code** in repository with clear modular structure
2. **Functional application** deployed (Vercel, Netlify, or GitHub Pages)
3. **Complete test suite** with ≥75% coverage
4. **Technical documentation** including:
    - README.md with installation and execution instructions
    - Game mechanics guide
    - Internal API documentation (JSDoc/TypeDoc)
    - Complete list of jokers, planets, and tarot with effects
5. **JSON configuration files** for all balanceable values
6. **Graphic assets** for cards, jokers, planets, tarot, and UI
7. **Flow diagram** of scoring system
8. **Class diagram** showing code architecture

---

## 22. **Balancing Considerations**

### 22.1 Balancing Principles

- **Early vs late jokers:** More expensive or rare jokers should have proportionally stronger effects
- **Intentional synergies:** Design specific combinations that reward coherent strategies
- **Balanced Boss Blinds:** Each boss should represent a unique challenge without being impossible
- **Adjusted economy:** Sufficient money for 1-2 purchases per blind if playing well
- **Difficulty curve:** Exponential but achievable increase with optimal strategy

### 22.2 Values Subject to Testing

- Shop reroll cost (currently undefined: suggested $2-5)
- Total number of rounds for victory (suggested: 8 rounds = 24 levels)
- Exact chip and mult values of jokers
- Goal growth rate per round (currently 1.5×)
- Number of cards in shop (currently 4)

---

**Final Notes:** This specification establishes a complete framework for developing a card game inspired by Balatro with deep but understandable mechanics. The system is designed to be implementable by AI while maintaining fidelity to poker rules, a strict score calculation order, and a balanced and progressive gameplay experience. All numerical values are configurable to facilitate post-implementation balancing.